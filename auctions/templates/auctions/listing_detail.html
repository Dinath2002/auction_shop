{% extends "core/base.html" %}
{% block title %}{{ product.title }} | AuctionShop{% endblock %}

{% block content %}
<div class="product-detail">
  <div class="product-main">
    {% if product.image %}
      <img src="{{ product.image.url }}" alt="{{ product.title }}" class="product-image">
    {% endif %}

    <h1>{{ product.title }}</h1>
    <p class="text-muted">Seller: {{ product.seller.username }}</p>
    <p>{{ product.description }}</p>

    {% if product.is_auction %}
      <h3>Current auction</h3>
      <p class="price">
        Current bid: Rs. {{ product.highest_bid|default:product.starting_bid }}
      </p>
      <p class="text-muted small">
        Ends: {{ product.auction_end|date:"Y-m-d H:i" }}
      </p>

      {% if product.time_left_seconds > 0 %}
        <form method="post" action="{% url 'auctions:place_bid' product.pk %}">
          {% csrf_token %}
          <label for="id_amount">Your bid</label>
          <input
            id="id_amount"
            name="amount"
            type="number"
            step="0.01"
            required
          >
          <button type="submit" class="btn btn-full">Place bid</button>
        </form>
      {% else %}
        <p><strong>Auction ended.</strong></p>
      {% endif %}

      <h3>Recent bids</h3>
      <ul>
        {% for b in bids %}
          <li>
            {{ b.bidder.username }}: Rs. {{ b.amount }}
            <span class="text-muted small">
              ({{ b.created_at|date:"Y-m-d H:i" }})
            </span>
          </li>
        {% empty %}
          <li>No bids yet.</li>
        {% endfor %}
      </ul>

    {% else %}
      <h3>Buy now</h3>
      <p class="price">Price: Rs. {{ product.price }}</p>

      {% if product.is_active %}
        <form method="post" action="{% url 'auctions:buy_now' product.pk %}">
          {% csrf_token %}
          <button type="submit" class="btn btn-full">Buy now</button>
        </form>
      {% else %}
        <p><strong>This item has been sold.</strong></p>
      {% endif %}
    {% endif %}
  </div>
</div>
{% endblock %}
